%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Please note that whilst this template provides a 
% preview of the typeset manuscript for submission, it 
% will not necessarily be the final publication layout.
%
% letterpaper/a4paper: US/UK paper size toggle
% num-refs/alpha-refs: numeric/author-year citation and bibliography toggle

%\documentclass[letterpaper]{oup-contemporary}
\documentclass[a4paper,num-refs]{oup-contemporary}

%%% Journal toggle; only specific options recognised.
%%% (Only "gigascience" and "general" are implemented now. Support for other journals is planned.)
\journal{gigascience}

\usepackage{graphicx}
\usepackage{siunitx}

%%% Flushend: You can add this package to automatically balance the final page, but if things go awry (e.g. section contents appearing out-of-order or entire blocks or paragraphs are coloured), remove it!
% \usepackage{flushend}

\title{Training Infrastructure as a Service}

%%% Use the \authfn to add symbols for additional footnotes, if any. 1 is reserved for correspondence emails; then continuing with 2 etc for contributions.
\author[1,\authfn{1},\authfn{2}]{Helena~Rasche}
\author[2,\authfn{2}]{Bj\"orn~Gr\"uning}

\affil[1]{Bioinformatics Group, Department of Computer Science, University of Freiburg, 79110 Freiburg im Breisgau, Germany}

%%% Author Notes
\authnote{\authfn{1}helena.rasche@gmail.com}
\authnote{\authfn{2}Contributed equally.}

%%% Paper category
\papercat{Technical Note}

%%% "Short" author for running page header
\runningauthor{Rasche and Gr\"uning}

%%% Should only be set by an editor
\jvolume{00}
\jnumber{0}
\jyear{2017}

\begin{document}

\begin{frontmatter}
\maketitle
\begin{abstract}
%The Abstract (250 words maximum) should be structured to include the following details: \textbf{Background}, the context and purpose of the study; \textbf{Results}, the main findings; \textbf{Conclusions}, brief summary and potential implications. Please minimize the use of abbreviations and do not cite references in the abstract.
% todo: sentence about how importnt hands-on training is
Hands-on training, whether it is in Bioinformatics or other scientific domains, requires significant resources and knowledge to setup.
Trainers must have access to infrastructure that can support the sudden spike in usage with classes of 30 students running sometimes resource intensive tools simultaneously.
The student jobs must run quickly and not wait in queues, lest they significantly disrupt the timetable set out for the class.
Often times this is achieved via running on a private server where there is no contention for the queue, one that the teacher often must set up, and be responsible for if any issues occur during their training.
Trainers can choose either on local infrastructure or the cloud, but in either case deployment requires them to have experience and knowledge as a system administrator, in addition to the biological domain about which they intend to teach.
These presents a significant burden, in terms of infrastructure cost, person-hours in preparation, technical knowledge, and available staff to manage such hands-on trainings.

\textbf{Findings:} Galaxy Europe has developed Training Infrastructure as a Service (TIaaS) which we provide to the scientific commnuity as a service built on top of the Galaxy Platform. Teachers request a training and UseGalaxy.eu administrators launch compute nodes in the cloud specifically for the training. Students, via the ``TIaaS Join Service'', follow a link and are placed into a Galaxy group. Internal routing rules direct their jobs to the cloud compute nodes. Teachers access the dashboard of the TIaaS Join Service and follow the progress of their students.

\textbf{Conclusions:} TIaaS provides reusable, free, and fast infrastructure for Galaxy training. The instructor dashboard provides visibility into class progress reducing the need for helpers who monitor students or self-reporting of progress. In the past 12 months, 55 trainings with over 1300 students have used this infrastructure for training across scientific domains, all enjoying the accessibility and reproducibility of Galaxy for training the next generation of bioinformaticians.
\end{abstract}

\begin{keywords}
Galaxy; Training; Teaching; Bioinformatics
\end{keywords}
\end{frontmatter}

%%% Key points will be printed at top of second page
\begin{keypoints*}
\begin{itemize}
\item This is the first point
\item This is the second point
\item One last point.
\end{itemize}
\end{keypoints*}


\section{Background}
\label{sec:background}

% The background section should be written in a way that is accessible to researchers without specialist knowledge in that area and must clearly state---and, if helpful, illustrate---the background to the research and its aims. The section should end with a brief statement of what is being reported in the article.

\subsection{Background}
With the volume of bioinformatics data becoming available, the availability of training for bioinformaticians is not keeping up (\ref{Attwood2017}).

The Galaxy Project has developed a wide array of hands-on training materials covering the bioinformatics domains and beyond (\ref{gtn}), but in order to run these trainings one needs access to sometimes significant resources. The popular ``Reference-based RNA-Seq data analysis'' tutorial uses the STAR aligner (\ref{Dobin2012}), and while an ultra-fast aligner is ideal during training, it also consumes 120 GB of RAM at minimum. Many tools across the training materials have sometimes hidden requirements, requiring that trainers test the workflows and configure their instance to support the minimum memory and CPU requirements.

Informally, many of our training peers complained about the amount of time that went into preparing courses for students, the infrastructure problem was a cause of stress. On public Galaxy servers, their students' jobs could sit in queues for days. On private or cloud infrastructure, the instructors were solely responsible for the functionality and any bugs could lead to significant stress and occasionally cancelling courses if there was not alternative infrastructure already avaialable.


\subsection{Results}
We implemented a web service and which function together to present a coherent experience to the user, trainer, and Galaxy administrator. Trainers register their course and teaching materials with a Google Form. Administrators review requests, and upon approval schedule cloud nodes to be launched, tagged for this training, and register the training with the Group Joining Service (GJS). Administrators receive a URL such as \texttt{https://usegalaxy.eu/join-training/test}, which they share with the trainer, and the trainer provides in turn to their students. Administrators additionally configure their Galaxy's job scheduling to be aware of this training group, and to place special requirements on the jobs submitted by users in this group, to direct them to private resources.

\begin{figure}[bt!]
\centering
\includegraphics[width=\linewidth]{images/dashboard.png}
\includegraphics[width=\linewidth]{images/queue.png}
	\caption{The top of the training dashboard page shows the status of the jobs in the past hours. A heatmap of the tools which were run indiciates if everything is running smoothly or if there is anything the teacher should look into. As students follow along and run different tools these show up, and complete, with approximately identical numbers of executions as students follow instructions. The bottom image shows the rest of the training dashboard, which lists jobs that were run chronologically, colour coded first by student, and second for the job status. Pseudorandom identifiers were originally used to protect user privacy as the dashboards were public, but even given the option to show more recognisable user identifiers was deemed to be distracting from the main purpose of a quick overview for teachers.}\label{figure:dashboard}
\end{figure}

The course dashboard, visualising the progress of students (\ref{figure:dashboard}), has significantly eased the lives trainers, based on anecdotal evidence.

Since the introduction of TIaaS in July 2018, it has seen nearly constant use with more than 55 trainings occuring on the platform, all across the world (\ref{figure:map}). Everything from one day workshops for bioinformaticians to multi-month courses for highschool students have been hosted by TIaaS and UseGalaxy.eu, covering topics such as HTS, RNA-Seq, ChIP-Seq, Imaging Analysis, Proteomics, and Machine Learning.

\begin{figure}[bt!]
\centering
\includegraphics[width=\linewidth]{images/map.png}
	\caption{Since its introduction, TIaaS has seen worldwide usage despite--or perhaps in some cases due to--the server being hosted in Germany.}\label{figure:map}
\end{figure}

Class sizes ranged considerably, from the median of 15 students to a maximum of 80 at a transcriptomics workshop.


\section{Methods}

\subsection{Implementation}
The group joining service was written in python using the Flask framework. It is a relatively small service, simply talking to the Galaxy DB and adding the user to a group.
The student progress dashboard was added to the same service, accessed at a url like \texttt{/join-training/<training-id>/status} it queries the Galaxy database for the users in that group, and then fetches all jobs created by those users in the past N hours, before displaying these as a list and several summary tables to the viewer.

\subsection{Reusability}
An Ansible role was produced for deploying the GJS, in order to simplify deployment at other sites. The routing rules unfortunately cannot easily be integrated into Galaxy itself, and must be re-implemented at other sites which wish to produce a similar setup. Galaxy provides the ability to talk to multiple cluster systems but unfortunately there is currently no generic abstraction for labelled nodes our the routing logic of HTCondor which we leverage for this private queueing.


\section{Availability of source code and requirements}

\begin{itemize}
\item Project name: ~Training Infrastructure as a Service
\item Github repository:~\url{https://github.com/usegalaxy-eu/tiaas-group-join/}
\item Training Manual: ~\url{https://training.galaxyproject.org/training-material/topics/instructors/tutorials/setup-tiaas-for-training/tutorial.html}
\item Operating system(s): ~Unix
\item Other requirements: ~Galaxy version 18.01 or higher
\item License: ~GNU AGPL-3.0
\end{itemize}

\section{Availability of supporting data and materials}



\section{Declarations}

\subsection{List of abbreviations}
%if abbreviations are used in the text they should be defined in the text at first use, and a list of abbreviations should be provided in alphabetical order.

\begin{itemize}
\item TIaaS: Training Infrastructure as a Service
\item GJS: TIaaS Group Join Service
\end{itemize}


\subsection{Competing Interests}

The authors declare that they have no competing interests.


\subsection{Funding}
This project was made possible with the support of the Albert Ludwig University of Freiburg
% TODO, deNBI elixir blah

\subsection{Author's Contributions}
HR and BG contributed to the tool development and writing of the manuscript.

\section{Acknowledgements}
The authors would like to thank the Galaxy community for their enthusiasm for this project, and their feedback on each iteration.

%% Specify your .bib file name here, without the extension
\bibliography{paper-refs}

\end{document}
